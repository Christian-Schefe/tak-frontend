@let takGame = game();
@let pOrder = playerOrder();
<div class="board-container">
  <div></div>
  <app-game-player-bar
    [gamePlayer]="players()[pOrder.p2]"
    [game]="takGame"
    [playerColor]="pOrder.p2"
  ></app-game-player-bar>
  <div></div>

  <div class="h-full w-full">
    <app-game-side-panel
      [game]="takGame"
      [drawState]="drawState()"
      [undoState]="undoState()"
      (setHistoryPlyIndex)="setHistoryPlyIndex.emit($event)"
      (requestDraw)="requestDraw.emit($event)"
      (requestUndo)="requestUndo.emit($event)"
      (resign)="resign.emit()"
    ></app-game-side-panel>
  </div>
  @switch (boardStyle) {
    @case ('2d') {
      <app-board-native-component
        [game]="takGame"
        [mode]="mode()"
        (action)="action.emit($event)"
      ></app-board-native-component>
    }
    @case ('ninja') {
      <app-board-ninja-component
        [game]="takGame"
        [mode]="mode()"
        (action)="action.emit($event)"
      ></app-board-ninja-component>
    }
  }
  <div class="h-full w-full">
    <app-game-chat-panel></app-game-chat-panel>
  </div>

  <div></div>
  <app-game-player-bar
    [gamePlayer]="players()[pOrder.p1]"
    [game]="takGame"
    [playerColor]="pOrder.p1"
  ></app-game-player-bar>
  <div></div>
  @let gameState = gameStateTrigger();
  @if (gameState.type !== 'ongoing') {
    <p-button (click)="showGameOverInfo.set(true)" class="absolute top-15 left-1/2 -translate-x-1/2"
      >Show Game Over Info</p-button
    >
    <p-dialog
      [(visible)]="showGameOverInfo"
      header="Game Over"
      [modal]="true"
      [dismissableMask]="true"
      [draggable]="false"
      [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
      [style]="{ width: '30vw' }"
    >
      @switch (gameState.type) {
        @case ('aborted') {
          <p>The game was aborted.</p>
        }
        @case ('win') {
          <p>
            {{ gameState.player === 'white' ? 'White' : 'Black' }} wins by
            @switch (gameState.reason) {
              @case ('road') {
                completing a road!
              }
              @case ('flats') {
                flat count! ({{ gameState.counts?.white }} to {{ gameState.counts?.black }} +
                {{ takGame.actualGame.settings.halfKomi / 2 }})
              }
              @case ('timeout') {
                timeout!
              }
              @case ('resignation') {
                resignation!
              }
              @case ('timeout or resignation') {
                timeout or resignation!
              }
            }
          </p>
        }
        @case ('draw') {
          <p>The game is a draw!</p>
        }
      }
    </p-dialog>
  }
</div>
